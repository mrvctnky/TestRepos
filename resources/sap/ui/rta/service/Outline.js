/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/dt/OverlayRegistry","sap/ui/dt/ElementOverlay","sap/ui/rta/Utils","sap/ui/dt/Util","sap/ui/dt/Overlay","sap/ui/dt/ElementUtil"],function(O,E,R,D,a,b){"use strict";return function(r){var o={oRta:r};o._getOutline=function(i,d){if(!d&&D.isInteger(i)){d=i;i=undefined;}var c=[];if(!i){c=this.oRta._oDesignTime.getRootElements().map(function(v){var e=b.getElementInstance(v);return O.getOverlay(e);});}else{var p=O.getOverlay(i);if(!p){throw D.createError("services.Outline#get","Valid id for the starting overlay should be provided or this parameter should be neglected ","sap.ui.rta");}c.push(p);}return c.map(function(I){return this._getChildrenNodes(I,d);}.bind(this));};o._getChildrenNodes=function(c,d,p){var v=D.isInteger(d);var e=this._getNodeProperties(c,p);var C=c.getChildren();if((!v||(v&&d>0))&&C.length>0){d=v?d-1:d;e.elements=C.map(function(f){return this._getChildrenNodes(f,d,f.getParent());},this);}return e;};o._getNodeProperties=function(c,p){var d;var A;var i;var t;var I=false;var f=c.getElement();var g=f.getId();var h=f.getMetadata().getName();var j=c.getDesignTimeMetadata();var k=j.getData();var l=(k.palette&&k.palette.icons&&k.palette.icons.svg||undefined);if(c instanceof E){t="element";i=j.getLabel(f);I=c.getEditable();d=j.getName(f);}else{t="aggregation";A=c.getAggregationName();i=j.getLabel(f);if(p instanceof E){d=p.getAggregation(A)?p.getDesignTimeMetadata().getAggregationDescription(A,f):undefined;}}var m={id:g,instanceName:i!==g?i:undefined,name:d&&d.singular,technicalName:A?A:h,editable:I,icon:l,type:t};try{return JSON.parse(JSON.stringify(m));}catch(e){throw D.createError("services.Outline#get",e.message,"sap.ui.rta");}};var s={exports:{get:o._getOutline.bind(o)}};return new Promise(function(f,c){var C=function(){return r._oDesignTime.getRootElements().some(function(d){return!O.getOverlay(d);});};if(!r._oDesignTime||C()){r.attachEventOnce("start",function(){f(s);});r.attachEventOnce("failed",function(){c(D.createError("services.Outline#get","Designtime failed to load. This is needed to start the Outline service","sap.ui.rta"));});}else{f(s);}});};},true);
